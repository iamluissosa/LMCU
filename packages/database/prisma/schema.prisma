// 1. Configuraci贸n del Generador
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------------------------
//  MODELO EMPRESA (Actualizado con RIF y Direcci贸n)
// --------------------------------------------------------
model Company {
  id   String @id @default(uuid())
  name String // Raz贸n Social (ej: CORPORACION J.P., C.A.)
  rif  String @unique // Identificador Fiscal (ej: J-40022503-5)

  // Direcci贸n Fiscal Detallada
  address String // (ej: Av. Miranda, Edif JP...)
  state   String // (ej: Carabobo)
  city    String // (ej: Montalb谩n)

  // Datos Fiscales
  taxpayerType String // 'Ordinario', 'Especial', 'Formal'

  // Contacto
  phone   String?
  email   String?
  website String?
  logoUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // RELACIONES (Una empresa tiene muchos...)
  users    User[]
  products Product[]
  clients  Client[]
  invoices Invoice[]
}

// --------------------------------------------------------
//  MODELO USUARIO
// --------------------------------------------------------
model User {
  id       String  @id @default(uuid())
  email    String  @unique
  password String
  name     String?
  role     String  @default("ADMIN") // ADMIN, USER, VENDEDOR

  // Relaci贸n: Un usuario pertenece a una empresa
  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --------------------------------------------------------
//  MODELO PRODUCTO
// --------------------------------------------------------
model Product {
  id           String  @id @default(uuid())
  code         String // C贸digo interno (ej: BEB-001)
  name         String
  priceBase    Decimal @db.Decimal(10, 2) // Precio sin IVA
  currentStock Int     @default(0)
  imageUrl     String?

  // Relaci贸n: Un producto pertenece a una empresa
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  invoiceItems InvoiceItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, code]) // No repetir c贸digos dentro de la misma empresa
}

// --------------------------------------------------------
//  MODELO CLIENTE (Necesario para Facturaci贸n)
// --------------------------------------------------------
model Client {
  id      String  @id @default(uuid())
  name    String
  rif     String? // RIF o C茅dula del cliente
  address String?
  phone   String?
  email   String?

  companyId String
  company   Company   @relation(fields: [companyId], references: [id])
  invoices  Invoice[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --------------------------------------------------------
//  MODELO FACTURA (Invoice)
// --------------------------------------------------------
model Invoice {
  id            String  @id @default(uuid())
  invoiceNumber Int // N煤mero correlativo (1, 2, 3...)
  controlNumber String? // N煤mero de control fiscal (si aplica)
  status        String  @default("DRAFT") // DRAFT (Borrador), PAID (Pagada), CANCELLED (Anulada)

  // Totales
  subtotal  Decimal @db.Decimal(12, 2)
  taxAmount Decimal @db.Decimal(12, 2) // Monto del IVA
  total     Decimal @db.Decimal(12, 2) // Total a Pagar

  date    DateTime  @default(now())
  dueDate DateTime? // Fecha de vencimiento (Cr茅dito)

  // Relaciones
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  clientId String
  client   Client @relation(fields: [clientId], references: [id])

  items InvoiceItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, invoiceNumber]) // El n煤mero de factura es 煤nico POR empresa
}

// --------------------------------------------------------
//  MODELO ITEMS DE FACTURA (Detalle)
// --------------------------------------------------------
model InvoiceItem {
  id        String  @id @default(uuid())
  quantity  Decimal @db.Decimal(12, 2)
  unitPrice Decimal @db.Decimal(12, 2)
  taxRate   Decimal @default(16.00) @db.Decimal(5, 2) // % IVA (16%)
  totalLine Decimal @db.Decimal(12, 2) // (Cantidad * Precio)

  // Relaciones
  invoiceId String
  invoice   Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])
}
